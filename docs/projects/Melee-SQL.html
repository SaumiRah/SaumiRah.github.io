<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>melee-sql</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-4d96db332f33ef296d8e0919d4f30bf1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.pdf"> <i class="bi bi-file-pdf" role="img">
</i> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/saumi-rahnamay/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sql-project-super-smash-bros.-melee" class="level1">
<h1>SQL Project: Super Smash Bros.&nbsp;Melee</h1>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li>This is a SQL project focused on measuring and improving my performance in a fighting game.</li>
<li><a href="#section-iii-sql-queries">Click here to skip to SQL queries</a></li>
<li>Queries used: <code>SQL     WITH... AS (AKA CTEs)     WHERE... (AND...)     HAVING     ROUND     SUM     COUNT     GROUP BY     ORDER BY     CASE... (WHEN... THEN... END)     CAST     LEFT JOIN     STRFTIME     DATE     TIME     BETWEEN</code></li>
</ul>
</section>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#sql-project-super-smash-bros-melee">SQL Project: Super Smash Bros.&nbsp;Melee</a>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#section-i-research-questions">Section I. Research Questions</a></li>
<li><a href="#section-ii-data-collection">Section II. Data Collection</a></li>
<li><a href="#section-iii-sql-queries">Section III. SQL Queries</a>
<ul>
<li><a href="#1-how-many-games-have-i-played-using-falco">1. How many games have I played using “Falco”?</a></li>
<li><a href="#2-what-are-my-best-and-worst-matchups">2. What are my best and worst matchups?</a></li>
<li><a href="#3-what-are-my-best-and-worst-stages">3. What are my best and worst stages?</a></li>
<li><a href="#4-what-are-my-best-and-worst-matchups-on-each-stage">4. What are my best and worst matchups on each stage?</a></li>
<li><a href="#5-when-do-i-play-best">5. When do I play best?</a>
<ul>
<li><a href="#51-day-of-the-week">5.1. Day of the Week</a></li>
<li><a href="#52-time-of-day">5.2. Time of Day</a></li>
<li><a href="#53-day-of-the-week-and-time-of-day">5.3. Day of the Week and Time of Day</a></li>
</ul></li>
</ul></li>
<li><a href="#section-iv-interpretation-and-key-insights">Section IV. Interpretation and Key Insights</a>
<ul>
<li><a href="#key-insights">Key Insights</a></li>
<li><a href="#matchups">Matchups</a></li>
<li><a href="#stages">Stages</a></li>
<li><a href="#day-of-weektime-of-day">Day of Week/Time of Day</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="section-i.-research-questions" class="level2">
<h2 class="anchored" data-anchor-id="section-i.-research-questions">Section I. Research Questions</h2>
<p><a href="https://en.wikipedia.org/wiki/Super_Smash_Bros._Melee">Super Smash Bros.&nbsp;Melee</a> (hereon, “Melee”) is a fighting game for the Nintendo GameCube, which was released on November 21st, 2001. More than two decades later, people are still playing Melee. More specifically, the game’s competitive community is thriving despite the game’s age. How could such an old game still have such an active fan base? <strong>Slippi</strong>. Slippi is an ongoing modding project by members of the Melee community which aims to render several major quality-of-life additions to the game. The two most major changes were rollback netcode and an integrated online matchmaking system. I started playing Melee in 2023 after hearing about this modding project and have been playing since.</p>
<p>In addition to these two features, another interesting addition the Slippi team made was an automatic replay saving feature, which saves a replay of every match of Melee you play online. The replay files are stored right onto the device running Slippi as a .slp file, which can be viewed through the Slippi launcher. What’s interesting about these files are that they are laden with <em>data</em>. By passing the replay files through a parsing program, we can view all sorts of data: Player characters and names, the winner of each game, the date and time of each game, the stage played on…</p>
<p>The goal of this project is to kill two birds with one stone: get better at SQL and Melee. By parsing my replay files, and placing them into a database, I can practice writing SQL scripts that pull key insights about my gameplay out of my replay database. Once I have these key insights, I can determine my strengths and weaknesses and adapt my playstyle accordingly in-game.</p>
<p>It’s also important to mention that there are many different characters to play in Melee, but most players pick one character and stick to them. In my case, I’m interested in playing <a href="https://ssb.wiki.gallery/images/thumb/e/e0/Falco_Idle_Pose_Melee_1.gif/200px-Falco_Idle_Pose_Melee_1.gif">Falco</a>.</p>
<p>Given that, these are the questions I wanted answered:</p>
<blockquote class="blockquote">
<ol type="1">
<li><strong>How many games</strong> have I played on Falco?
<ul>
<li>Count of games on Falco.</li>
</ul></li>
<li>What are my best and worst <strong>matchups</strong>?
<ul>
<li>Average win-rate vs every character.</li>
</ul></li>
<li>What are my best and worst <strong>stages</strong>?
<ul>
<li>Average win-rate on every stage.</li>
</ul></li>
<li>What are my best and worst <strong>matchups on each stage</strong>?
<ul>
<li>Average win-rates on every matchup-stage combination.</li>
</ul></li>
<li><strong>When</strong> do I play best?
<ul>
<li>Average win-rate on every day of the week.</li>
<li>Average win-rate at different times of day (e.g.&nbsp;Morning)</li>
<li>Average win-rate on every day of the week and at every time of day.</li>
</ul></li>
</ol>
</blockquote>
</section>
<section id="section-ii.-data-collection" class="level2">
<h2 class="anchored" data-anchor-id="section-ii.-data-collection">Section II. Data Collection</h2>
<p>I used <a href="https://github.com/mtimkovich/slippi-db">Slippi DB</a> to parse replay files and place them into a SQLite database.</p>
<p>I’ve been accumulating replays over the course of approximately a year (since I started playing in 2023).</p>
<blockquote class="blockquote">
<p>Total number of replays: 3313</p>
</blockquote>
</section>
<section id="section-iii.-sql-queries" class="level2">
<h2 class="anchored" data-anchor-id="section-iii.-sql-queries">Section III. SQL Queries</h2>
<section id="how-many-games-have-i-played-using-falco" class="level3">
<h3 class="anchored" data-anchor-id="how-many-games-have-i-played-using-falco">1. How many games have I played using “Falco”?</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Starting by filtering down to only the games where I play Falco</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        me.<span class="dt">character</span> <span class="kw">as</span> bird </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span> <span class="co">-- x /= y (there are two unique objects in the domain)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id <span class="co">-- Gxy &amp; Gyx (One object is in the same game as the other, and vice versa)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span> <span class="co">-- Cx'Falco'  (One object has the property of playing Falco)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span> <span class="co">-- Ox'FROG#671' (That object also has my specific code)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> bird <span class="kw">as</span> <span class="dt">Character</span>, <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> <span class="ot">"Games played"</span> <span class="co">-- Counting Games</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> falco_games;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output: |Character|Games played | |———|—————————–| |FALCO |2332 |</p>
</section>
<section id="what-are-my-best-and-worst-matchups" class="level3">
<h3 class="anchored" data-anchor-id="what-are-my-best-and-worst-matchups">2. What are my best and worst matchups?</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        me.game_id, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        op.<span class="dt">character</span> <span class="kw">as</span> matchups, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> didIwin</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> matchups <span class="kw">as</span> <span class="st">'Matchups'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>((<span class="fu">sum</span>(didIwin)<span class="op">*</span><span class="fl">1.0</span> <span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>), <span class="dv">1</span>) <span class="kw">as</span> Winrate, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Winrate: The percetentage of time I win...</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> <span class="st">'Games played'</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> falco_games</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> matchups                                           <span class="co">-- ... each matchup</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Winrate <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Matchups</th>
<th>Winrate</th>
<th>Games played</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MEWTWO</td>
<td>66.7</td>
<td>9</td>
</tr>
<tr class="even">
<td>GAME_AND_WATCH</td>
<td>66.7</td>
<td>12</td>
</tr>
<tr class="odd">
<td>BOWSER</td>
<td>66.7</td>
<td>3</td>
</tr>
<tr class="even">
<td>YOUNG_LINK</td>
<td>63.6</td>
<td>11</td>
</tr>
<tr class="odd">
<td>ROY</td>
<td>60</td>
<td>15</td>
</tr>
<tr class="even">
<td>PIKACHU</td>
<td>57.1</td>
<td>14</td>
</tr>
<tr class="odd">
<td>SAMUS</td>
<td>56.7</td>
<td>30</td>
</tr>
<tr class="even">
<td>CAPTAIN_FALCON</td>
<td>54.7</td>
<td>338</td>
</tr>
<tr class="odd">
<td>MARIO</td>
<td>52.9</td>
<td>34</td>
</tr>
<tr class="even">
<td>DONKEY_KONG</td>
<td>52.9</td>
<td>51</td>
</tr>
<tr class="odd">
<td>SHEIK</td>
<td>52.8</td>
<td>159</td>
</tr>
<tr class="even">
<td>FOX</td>
<td>51.3</td>
<td>392</td>
</tr>
<tr class="odd">
<td>FALCO</td>
<td>48.7</td>
<td>622</td>
</tr>
<tr class="even">
<td>YOSHI</td>
<td>46.2</td>
<td>13</td>
</tr>
<tr class="odd">
<td>NESS</td>
<td>45.5</td>
<td>11</td>
</tr>
<tr class="even">
<td>LUIGI</td>
<td>45.5</td>
<td>44</td>
</tr>
<tr class="odd">
<td>MARTH</td>
<td>44.9</td>
<td>365</td>
</tr>
<tr class="even">
<td>KIRBY</td>
<td>42.9</td>
<td>7</td>
</tr>
<tr class="odd">
<td>ZELDA</td>
<td>40</td>
<td>5</td>
</tr>
<tr class="even">
<td>GANONDORF</td>
<td>34.2</td>
<td>76</td>
</tr>
<tr class="odd">
<td>LINK</td>
<td>33.3</td>
<td>21</td>
</tr>
<tr class="even">
<td>ICE_CLIMBERS</td>
<td>33.3</td>
<td>6</td>
</tr>
<tr class="odd">
<td>PEACH</td>
<td>31.3</td>
<td>48</td>
</tr>
<tr class="even">
<td>JIGGLYPUFF</td>
<td>27.3</td>
<td>33</td>
</tr>
<tr class="odd">
<td>DR_MARIO</td>
<td>25</td>
<td>12</td>
</tr>
<tr class="even">
<td>PICHU</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
<section id="what-are-my-best-and-worst-stages" class="level3">
<h3 class="anchored" data-anchor-id="what-are-my-best-and-worst-stages">3. What are my best and worst stages?</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        me.game_id <span class="kw">as</span> gid, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> winner</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> stage <span class="kw">as</span> Stage,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">round</span>((<span class="fu">sum</span>(winner)<span class="op">*</span><span class="fl">1.0</span><span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>),<span class="dv">1</span>) <span class="kw">as</span> Winrate,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">From</span> falco_games</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> games <span class="kw">on</span> gid <span class="op">=</span> games.<span class="kw">id</span> <span class="co">--Left joining with games to get stage data</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Stage</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">10</span> <span class="co">-- Ignore games on stages I've played less than 10 times</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Winrate <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>: |Stage|Winrate |count(*)| |—–|—————————–|——–| |FINAL_DESTINATION|52.6 |382 | |POKEMON_STADIUM|52.4 |393 | |FOUNTAIN_OF_DREAMS|47.7 |392 | |YOSHIS_STORY|46.8 |389 | |DREAM_LAND_N64|46.6 |371 | |BATTLEFIELD|46.1 |399 |</p>
</section>
<section id="what-are-my-best-and-worst-matchups-on-each-stage" class="level3">
<h3 class="anchored" data-anchor-id="what-are-my-best-and-worst-matchups-on-each-stage">4. What are my best and worst matchups on each stage?</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span> <span class="kw">as</span> mid, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        me.game_id <span class="kw">as</span> gid,  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        op.<span class="dt">character</span> <span class="kw">as</span> matchup, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> winner</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">Select</span> stage <span class="kw">as</span> Stage, matchup,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>((<span class="fu">sum</span>(winner)<span class="op">*</span><span class="fl">1.0</span><span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>), <span class="dv">1</span>) <span class="kw">as</span> Winrate,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">From</span> falco_games</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> games <span class="kw">on</span> gid <span class="op">=</span> games.<span class="kw">id</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Stage, matchup</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">10</span> <span class="co">-- filtering out stage-matchup combinations that I have played on/against less than 10 times</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Winrate <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>: |Stage|matchup |Winrate|count(*)| |—–|—————————–|——-|——–| |YOSHIS_STORY|DONKEY_KONG |70 |10 | |FINAL_DESTINATION|SHEIK |62.5 |32 | |BATTLEFIELD|CAPTAIN_FALCON |61.3 |62 | |POKEMON_STADIUM|FOX |61.3 |62 | |FOUNTAIN_OF_DREAMS|CAPTAIN_FALCON |60.3 |58 | |POKEMON_STADIUM|LUIGI |60 |10 | |BATTLEFIELD|SHEIK |57.1 |28 | |FOUNTAIN_OF_DREAMS|SHEIK |57.1 |21 | |FINAL_DESTINATION|MARTH |56.3 |64 | |FINAL_DESTINATION|FOX |55.1 |69 | |YOSHIS_STORY|CAPTAIN_FALCON |54.4 |57 | |FINAL_DESTINATION|FALCO |53.8 |93 | |DREAM_LAND_N64|CAPTAIN_FALCON |53.7 |54 | |POKEMON_STADIUM|FALCO |53.7 |108 | |POKEMON_STADIUM|SHEIK |51.9 |27 | |FINAL_DESTINATION|GANONDORF |50 |14 | |FOUNTAIN_OF_DREAMS|MARTH |50 |54 | |POKEMON_STADIUM|CAPTAIN_FALCON |50 |52 | |YOSHIS_STORY|FOX |48.5 |66 | |DREAM_LAND_N64|FOX |48.1 |54 | |DREAM_LAND_N64|FALCO |47.4 |97 | |FINAL_DESTINATION|CAPTAIN_FALCON |47.3 |55 | |BATTLEFIELD|FALCO |47.1 |102 | |FOUNTAIN_OF_DREAMS|FOX |47 |66 | |BATTLEFIELD|FOX |46.6 |73 | |YOSHIS_STORY|FALCO |45.7 |105 | |BATTLEFIELD|PEACH |45.5 |11 | |FOUNTAIN_OF_DREAMS|FALCO |45.3 |117 | |DREAM_LAND_N64|SHEIK |44.8 |29 | |DREAM_LAND_N64|GANONDORF |43.8 |16 | |POKEMON_STADIUM|MARTH |43.5 |69 | |YOSHIS_STORY|MARTH |41.7 |60 | |YOSHIS_STORY|SHEIK |40.9 |22 | |DREAM_LAND_N64|MARTH |39.7 |58 | |BATTLEFIELD|MARTH |39 |59 | |FOUNTAIN_OF_DREAMS|GANONDORF |36.4 |11 | |DREAM_LAND_N64|DONKEY_KONG |30 |10 | |YOSHIS_STORY|GANONDORF |28.6 |14 | |POKEMON_STADIUM|GANONDORF |27.3 |11 | |BATTLEFIELD|GANONDORF |10 |10 |</p>
</section>
<section id="when-do-i-play-best" class="level3">
<h3 class="anchored" data-anchor-id="when-do-i-play-best">5. When do I play best?</h3>
<section id="day-of-the-week" class="level4">
<h4 class="anchored" data-anchor-id="day-of-the-week">5.1. Day of the Week</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span> <span class="kw">as</span> mid, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        me.game_id <span class="kw">as</span> gid, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> winner</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> <span class="fu">CAST</span> (strftime(<span class="st">'%w'</span>, <span class="dt">DATE</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>)   <span class="co">--strftime(%w,...) to get the day of the week based on the date of the game</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">then</span> <span class="st">'Sunday'</span><span class="co">-- Instead of expressing each day of week as an integer (sunday=0... saturday=6), strings</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">then</span> <span class="st">'Monday'</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">2</span> <span class="cf">then</span> <span class="st">'Tuesday'</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">3</span> <span class="cf">then</span> <span class="st">'Wednesday'</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">4</span> <span class="cf">then</span> <span class="st">'Thursday'</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="dv">5</span> <span class="cf">then</span> <span class="st">'Friday'</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">'Saturday'</span> <span class="cf">end</span> <span class="kw">as</span> <span class="ot">"Day of Week"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>((<span class="fu">sum</span>(winner)<span class="op">*</span><span class="fl">1.0</span><span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>), <span class="dv">1</span>) <span class="kw">as</span> Winrate,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> Games</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">From</span> falco_games</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> games <span class="kw">on</span> gid <span class="op">=</span> games.<span class="kw">id</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Winrate <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Day of Week</th>
<th>Winrate</th>
<th>Games</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Wednesday</td>
<td>52.3</td>
<td>369</td>
</tr>
<tr class="even">
<td>Thursday</td>
<td>50.9</td>
<td>379</td>
</tr>
<tr class="odd">
<td>Saturday</td>
<td>48.1</td>
<td>318</td>
</tr>
<tr class="even">
<td>Tuesday</td>
<td>47.5</td>
<td>396</td>
</tr>
<tr class="odd">
<td>Monday</td>
<td>47.4</td>
<td>388</td>
</tr>
<tr class="even">
<td>Friday</td>
<td>47.2</td>
<td>299</td>
</tr>
<tr class="odd">
<td>Sunday</td>
<td>46.4</td>
<td>183</td>
</tr>
</tbody>
</table>
</section>
<section id="time-of-day" class="level4">
<h4 class="anchored" data-anchor-id="time-of-day">5.2. Time of Day</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span> <span class="kw">as</span> mid, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        me.game_id <span class="kw">as</span> gid, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> winner</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span> <span class="co">-- Defining different times of the day based on the hour of the day</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">0</span> <span class="kw">AND</span> <span class="dv">5</span> <span class="cf">THEN</span> <span class="st">'Late Night (12AM-5AM)'</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">5</span> <span class="kw">AND</span> <span class="dv">9</span> <span class="cf">THEN</span> <span class="st">'Morning (5AM-9AM)'</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">9</span> <span class="kw">AND</span> <span class="dv">14</span> <span class="cf">THEN</span> <span class="st">'Noon (9AM-2PM)'</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">14</span> <span class="kw">AND</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="st">'Afternoon (2PM-7PM)'</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="op">&gt;=</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="st">'Evening (7PM-12AM)'</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="kw">AS</span> <span class="ot">"Time of Day"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>((<span class="fu">sum</span>(winner)<span class="op">*</span><span class="fl">1.0</span><span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>), <span class="dv">1</span>) <span class="kw">as</span> Winrate,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> <span class="ot">"Games Played"</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">From</span> falco_games</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> games <span class="kw">on</span> gid <span class="op">=</span> games.<span class="kw">id</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="cf">CASE</span> <span class="co">-- Aesthetic reordering so 'Morning' comes first, and 'Late Night' comes last</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">0</span> <span class="kw">AND</span> <span class="dv">5</span> <span class="cf">THEN</span> <span class="dv">5</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">5</span> <span class="kw">AND</span> <span class="dv">9</span> <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">9</span> <span class="kw">AND</span> <span class="dv">14</span> <span class="cf">THEN</span> <span class="dv">2</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">14</span> <span class="kw">AND</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="dv">3</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="op">&gt;=</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="dv">4</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>: |Time of Day|Winrate |Games Played| |———–|—————————–|————| |Morning (5AM-9AM)|47.8 |370 | |Noon (9AM-2PM)|61.5 |13 | |Afternoon (2PM-7PM)|48.6 |210 | |Evening (7PM-12AM)|46.2 |650 | |Late Night (12AM-5AM)|50.5 |1089 |</p>
</section>
<section id="day-of-the-week-and-time-of-day" class="level4">
<h4 class="anchored" data-anchor-id="day-of-the-week-and-time-of-day">5.3. Day of the Week and Time of Day</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>falco_games <span class="kw">AS</span> (</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> me.<span class="kw">id</span> <span class="kw">as</span> mid, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        me.game_id <span class="kw">as</span> gid, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        me.winner <span class="kw">as</span> winner</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> players me, players op </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> me.<span class="kw">id</span> <span class="op">!=</span> op.<span class="kw">id</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.game_id <span class="op">=</span> op.game_id</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.<span class="dt">character</span><span class="op">=</span><span class="st">'FALCO'</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> me.code<span class="op">=</span><span class="st">'FROG#671'</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span> <span class="fu">CAST</span> (strftime(<span class="st">'%w'</span>, <span class="dt">DATE</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">then</span> <span class="st">'Sunday'</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">then</span> <span class="st">'Monday'</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">2</span>  <span class="cf">then</span> <span class="st">'Tuesday'</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">3</span> <span class="cf">then</span> <span class="st">'Wednesday'</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">4</span> <span class="cf">then</span> <span class="st">'Thursday'</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="dv">5</span> <span class="cf">then</span> <span class="st">'Friday'</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="st">'Saturday'</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="kw">as</span> <span class="st">'Day of Week'</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">CASE</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">0</span> <span class="kw">AND</span> <span class="dv">5</span> <span class="cf">THEN</span> <span class="st">'Late Night (12AM-5AM)'</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">5</span> <span class="kw">AND</span> <span class="dv">9</span> <span class="cf">THEN</span> <span class="st">'Morning (5AM-9AM)'</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">9</span> <span class="kw">AND</span> <span class="dv">14</span> <span class="cf">THEN</span> <span class="st">'Noon (9AM-2PM)'</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="kw">BETWEEN</span> <span class="dv">14</span> <span class="kw">AND</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="st">'Afternoon (2PM-7PM)'</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">WHEN</span> <span class="fu">CAST</span> (strftime(<span class="st">'%H'</span>, <span class="dt">TIME</span>(start_time)) <span class="kw">as</span> <span class="dt">int</span>) <span class="op">&gt;=</span> <span class="dv">19</span> <span class="cf">THEN</span> <span class="st">'Evening (7PM-12AM)'</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="kw">AS</span> <span class="st">'Time of Day'</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>((<span class="fu">sum</span>(winner)<span class="op">*</span><span class="fl">1.0</span><span class="op">/</span><span class="fu">count</span>(<span class="op">*</span>)<span class="op">*</span><span class="dv">100</span>), <span class="dv">1</span>) <span class="kw">as</span> Winrate,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> Games</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="kw">From</span> falco_games</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> games <span class="kw">on</span> gid <span class="op">=</span> games.<span class="kw">id</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span>, <span class="dv">2</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> Games <span class="op">&gt;=</span> <span class="dv">10</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Winrate <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output, ordered by <code>Winrate</code>: |Day of Week|Time of Day |Winrate|Games| |———–|—————————–|——-|—–| |Thursday |Late Night (12AM-5AM) |56 |184 | |Wednesday |Afternoon (2PM-7PM) |56 |75 | |Wednesday |Evening (7PM-12AM) |55.1 |78 | |Monday |Morning (5AM-9AM) |54.5 |33 | |Sunday |Afternoon (2PM-7PM) |54.5 |11 | |Tuesday |Morning (5AM-9AM) |53.3 |15 | |Tuesday |Afternoon (2PM-7PM) |53.1 |32 | |Saturday |Late Night (12AM-5AM) |52.4 |187 | |Wednesday |Late Night (12AM-5AM) |52.4 |126 | |Monday |Late Night (12AM-5AM) |50 |184 | |Saturday |Morning (5AM-9AM) |50 |32 | |Wednesday |Noon (9AM-2PM) |50 |10 | |Sunday |Morning (5AM-9AM) |49.4 |89 | |Friday |Morning (5AM-9AM) |48.8 |43 | |Friday |Afternoon (2PM-7PM) |47.5 |40 | |Tuesday |Late Night (12AM-5AM) |47.1 |261 | |Friday |Late Night (12AM-5AM) |46.9 |98 | |Friday |Evening (7PM-12AM) |46.6 |118 | |Wednesday |Morning (5AM-9AM) |46.3 |80 | |Thursday |Evening (7PM-12AM) |46.2 |106 | |Tuesday |Evening (7PM-12AM) |45.5 |88 | |Sunday |Late Night (12AM-5AM) |44.9 |49 | |Saturday |Evening (7PM-12AM) |44.7 |76 | |Monday |Evening (7PM-12AM) |44 |150 | |Thursday |Morning (5AM-9AM) |42.3 |78 | |Sunday |Evening (7PM-12AM) |38.2 |34 | |Monday |Afternoon (2PM-7PM) |38.1 |21 | |Saturday |Afternoon (2PM-7PM) |21.7 |23 |</p>
</section>
</section>
</section>
<section id="section-iv.-interpretation-and-key-insights" class="level2">
<h2 class="anchored" data-anchor-id="section-iv.-interpretation-and-key-insights">Section IV. Interpretation and Key Insights</h2>
<section id="key-insights" class="level3">
<h3 class="anchored" data-anchor-id="key-insights">Key Insights</h3>
<blockquote class="blockquote">
<ul>
<li>I need practice against Jigglypuff.</li>
<li>I need practice on Battlefield.</li>
<li>Counterpick to Final Destination against Sheik, Marth and Fox.</li>
<li>Avoid Battlefield against Marth, Peach, Fox and Falco.</li>
<li>Against Captain Falcon, counterpick to Battlefield and avoid Final Destination. ### Matchups First, looking at my matchup win-rates, we can see that my best matchups are against Mewtwo, Bowser, and Game and Watch. This makes sense because these characters are generally considered weak characters according to the <a href="https://images.ctfassets.net/er5eblldu1i7/1w88iRq70og23WAFYzyjYg/22644ad3b6cc6719dead307c52a6f53d/13TH_MELEE_TIERLIST.png">community tier-list</a> (i.e., a “low-tier” character), which also explains why I’ve played against so few of them. Compare this to someone like Captain Falcon, who I’ve played against many more times (n=338). My matchups against high-tiers generally matter more than against non-high-tiers, simply because more people play them.</li>
</ul>
</blockquote>
<p>My highest win-rate against a “high-tier” character is 54.7% against Captain Falcon, and my lowest is 27.3% against Jigglypuff. This suggests that I need more practice against Jigglypuff, and that I’m well practiced against Captain Falcon.</p>
</section>
<section id="stages" class="level3">
<h3 class="anchored" data-anchor-id="stages">Stages</h3>
<p>Looking at my stage win-rates, it’s interesting to see that Final Destination is my best stage. Traditional wisdom suggests Falco, my character, is <em>bad</em> on Final Destination. This is bizarre, but situationally advantageous when counter-picking a stage in tournament. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Looking at my stage-matchup win-rates, I am more than 50% likely to beat Sheik, Marth and Fox on Final Destination, who all generally like to counterpick to Final Destination. However, my win-rate against Captain Falcon is losing on Final Destination at 47.3%. So, if I beat Sheik, Marth or Fox in game 1, they might unknowingly counterpick my best stage. If I lose in game 1, I know to counterpick to Final Destination, <strong>unless I’m playing against Captain Falcon.</strong></p>
<p>Furthermore, Battlefield is my worst stage, which according to traditional wisdom should be one of Falco’s <em>best</em> stages. Looking at my stage-matchup win-rates, I can see that I am more likely to lose on Battlefield against Marth, Peach, Fox, and Falco. So, <strong>I should avoid Battlefield against Marth, Peach, Fox and Falco</strong> whenever possible. But funnily enough, Captain Falcon is again the exception. My win-rate against Captain Falcon on Battlefield is my third best mathcup at 61.3%. So, <strong>I should pick Battlefield against Captain Falcon.</strong></p>
</section>
<section id="day-of-weektime-of-day" class="level3">
<h3 class="anchored" data-anchor-id="day-of-weektime-of-day">Day of Week/Time of Day</h3>
<p>I was very surprised to see that I play the best on Wednesdays. This was also reflected in the Day of the Week - Time of Day win-rates, where my top 3 performances were on varying times on Wednesday. <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> I can only speculate, but I suspect this outcome is a result of my and other people’s work schedules. For around a year Wednesdays were my day off, which gave me more time to relax and play Melee. Generally, people don’t have Wednesdays off, so my opponents were probably suffering from the stress of work on Wednesdays. I believe it was a combination of my atypical and other people’s typical work schedule. This simply suggests that stress makes people perform worse in Melee.</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Tournament sets are usually best out of 3. Rock, Paper, Scissors determines who picks the stage for the first game. The loser of the first game gets to pick the stage for the second game. The strategy of picking a stage that favors your character over the opponent’s is called counter-picking.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Thursday at 12-5AM is my highest winrate day-hour, which is technically a calendar-Thursday. However, it’s better to interpret it as a Wednesday play session.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>